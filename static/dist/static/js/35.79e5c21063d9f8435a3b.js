(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[35],{283:function(t,a,n){"use strict";n.r(a);var e=n(284);var i=n.n(e);for(var r in e)if(r!=="default")(function(t){n.d(a,t,function(){return e[t]})})(r);a["default"]=i.a},284:function(t,a,n){"use strict";var e=n(1);Object.defineProperty(a,"__esModule",{value:true});a.default=void 0;var i=e(n(3));var r=n(209);var o=n(208);var l=n(13);var d=n(207);var s=n(210);var u=n(14);function p(t,a){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(t);a&&(e=e.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,e)}return n}function c(t){for(var a=1;a<arguments.length;a++){var n=null!=arguments[a]?arguments[a]:{};a%2?p(Object(n),!0).forEach(function(a){(0,i.default)(t,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(n,a))})}return t}var _={name:"ended-approval",components:{ApprovalStateTag:function t(){return n.e(0).then(n.bind(null,294))},SliderLayout:function t(){return n.e(1).then(n.bind(null,315))}},mixins:[o.tableMixins],data:function t(){return{ingReviewRemoteData:[],ingReviewApplicationDetailRemoteData:[],ingAwardApplicationDetailPagination:c({},o.paginationTemplate),curAwardInfo:{},isOnlyDetail:false}},computed:{ingReviewData:function t(a){var n;return(n=a.ingReviewRemoteData)===null||n===void 0?void 0:n.map(function(t){var a,n;var e=(a=(n=t["award_reviewers"])===null||n===void 0?void 0:n.map(function(t,a){var n;return{uuid:s.uuid.get(),description:(n="第"+(a+1)+"轮:"+t.join(","))!==null&&n!==void 0?n:""}}))!==null&&a!==void 0?a:[];return{award_id:t["id"],award_name:t["award_name"],award_description:t["award_description"],award_department_fullname:t["award_department_fullname"],award_department_id:t["award_department_id"],award_reviewers:t["award_reviewers"],award_reviewers_for_display:e,award_consultant:t["award_consultant"],award_consultant_displayname:t["award_consultant_displayname"],award_consultant_displayname_for_display:(0,u.formatUsernameAndDisplayName)(t["award_consultant"],t["award_consultant_displayname"]),award_demand:t["award_demand"],start_time:(0,u.formatDate)(t["start_time"]),end_time:(0,u.formatDate)(t["end_time"]),approval_state:t["approval_state"],approval_state_en:l.APPLY_APPROVAL_STATE_EN_MAP[t["approval_state"]],approval_state_cn:l.APPLY_APPROVAL_STATE_MAP[t["approval_state"]]}})},ingAwardApplicationDetailData:function t(a){var n,e;return(n=(e=a.ingReviewApplicationDetailRemoteData)===null||e===void 0?void 0:e.map(function(t){var a,n,e,i;var r=(a=(n=t["application_users"])===null||n===void 0?void 0:n[0])!==null&&a!==void 0?a:{};var o=t["award_info"];var d=(e=(i=o["award_reviewers"])===null||i===void 0?void 0:i.map(function(t,a){var n;return{uuid:s.uuid.get(),description:(n="第"+(a+1)+"轮:"+t.join(","))!==null&&n!==void 0?n:""}}))!==null&&e!==void 0?e:[];return{application_id:t["id"],award_id:t["award_id"],award_department_id:t["award_department_id"],approval_turn:t["approval_turn"],approval_text:t["approval_text"],approval_state:t["approval_state"],award_reviewers_for_display:d,approval_state_en:l.APPLY_APPROVAL_STATE_EN_MAP[t["approval_state"]],approval_state_cn:l.APPLY_APPROVAL_STATE_MAP[t["approval_state"]],application_time:(0,u.formatDate)(t["application_time"]),application_users:t["application_users"],application_user_for_display:(0,u.formatUsernameAndDisplayName)(r["username"],r["display_name"])}}))!==null&&n!==void 0?n:[]}},created:function t(){this.handleInit()},methods:{handleInit:function t(){Promise.all([this.handleGetIngReview()])},handleGetIngReview:function t(){var a=this;var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.pagination.current;var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.pagination.limit;if(this.loading)return;this.loading=true;var i={page:n,size:e,award_status:l.ING_REVIEW,group_id:this.$bus.curGlobalGroupId};return(0,r.getAwards)(i).then(function(t){var n=t.data;a.pagination.count=n.count;a.ingReviewRemoteData=n.data}).finally(function(t){a.loading=false})},handleToGetDetail:function t(a){console.log(a);this.$router.push({name:l.AWARD_APPLICATION_DETAILS_ROUTE_PATH,query:{award_id:a["award_id"],group_id:this.$bus.curGlobalGroupId}})},handleToOverAward:function t(a){var n=this;var e=a.award_id;return(0,r.postFinishAward)({awardId:e}).then(function(t){n.handleInit();n.messageSuccess("已成功终止奖项评审");n.toHiddenAwardApplicationInfo()})},toGetAwardApplicationDetail:function t(a,n){var e=this;this.curAwardInfo=a;var i=a["award_id"];this.toShowAwardApplicationInfo();this.isOnlyDetail=n;return(0,d.getAwardApplication)({id:i}).then(function(t){var a,n;var i=t.data;e.ingAwardApplicationDetailPagination.count=(a=i.count)!==null&&a!==void 0?a:0;e.ingReviewApplicationDetailRemoteData=(n=i.results)!==null&&n!==void 0?n:[];return Promise.resolve()}).then(function(t){return e.toShowAwardApplicationInfo()})},toShowAwardApplicationInfo:function t(){this.$refs["application-detail"].show()},toHiddenAwardApplicationInfo:function t(){this.$refs["application-detail"].hidden()}}};a.default=_},358:function(t,a,n){"use strict";n.r(a);var e=n(401);var i=n(283);for(var r in i)if(r!=="default")(function(t){n.d(a,t,function(){return i[t]})})(r);var o=n(18);var l=Object(o["a"])(i["default"],e["a"],e["b"],false,null,null,null);a["default"]=l.exports},401:function(t,a,n){"use strict";var e=function(){var t=this;var a=t.$createElement;var n=t._self._c||a;return n("div",[n("self-table",{attrs:{data:t.ingReviewData,loading:t.loading,pagination:t.pagination},on:{"update:pagination":function(a){t.pagination=a},"page-change":function(a){t.handleInit()}}},[n("bk-table-column",{attrs:{type:"index",label:"序号",width:"60"}}),t._v(" "),n("bk-table-column",{attrs:{label:"奖项名称",prop:"award_name",width:200},scopedSlots:t._u([{key:"default",fn:function(a){return[n("span",{attrs:{title:a.row["award_name"]}},[t._v("\n                    "+t._s(a.row["award_name"])+"\n                ")])]}}])}),t._v(" "),n("bk-table-column",{attrs:{label:"申请开始时间",prop:"start_time"}}),t._v(" "),n("bk-table-column",{attrs:{label:"申请截止时间",prop:"end_time"}}),t._v(" "),n("bk-table-column",{attrs:{label:"奖项咨询人"},scopedSlots:t._u([{key:"default",fn:function(a){return[n("span",{attrs:{title:a.row["award_consultant_displayname_for_display"]}},[t._v("\n\n                    "+t._s(a.row["award_consultant_displayname_for_display"])+"\n                ")])]}}])}),t._v(" "),n("bk-table-column",{attrs:{label:"总评审轮次"},scopedSlots:t._u([{key:"default",fn:function(a){return[n("bk-select",{attrs:{value:1,clearable:false}},t._l(a.row["award_reviewers_for_display"],function(t,a){return n("bk-option",{key:t["uuid"],attrs:{name:t["description"],id:a+1,title:t["description"]}})}),1)]}}])}),t._v(" "),n("bk-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(a){return[n("bk-button",{staticClass:"mr10",attrs:{text:true},on:{click:function(n){t.toGetAwardApplicationDetail(a.row,true)}}},[t._v("\n                    查看申请详情\n                ")]),t._v(" "),n("bk-button",{staticClass:"mr20 ml20 ",attrs:{theme:"danger",text:true},on:{click:function(n){t.toGetAwardApplicationDetail(a.row,false)}}},[t._v("\n                    结束奖项\n                ")])]}}])})],1),t._v(" "),n("slider-layout",{ref:"application-detail",attrs:{"header-title":t.curAwardInfo["award_name"],width:650}},[n("div",{attrs:{slot:"content"},slot:"content"},[n("self-table",{attrs:{data:t.ingAwardApplicationDetailData,loading:t.loading,pagination:t.ingAwardApplicationDetailPagination},on:{"update:pagination":function(a){t.ingAwardApplicationDetailPagination=a}}},[n("bk-table-column",{attrs:{label:"序号",type:"index",width:80}}),t._v(" "),n("bk-table-column",{attrs:{label:"申请人"},scopedSlots:t._u([{key:"default",fn:function(a){return[n("span",{attrs:{title:a.row["application_user_for_display"]},domProps:{textContent:t._s(a.row["application_user_for_display"])}})]}}])}),t._v(" "),n("bk-table-column",{attrs:{label:"评审轮次",width:300},scopedSlots:t._u([{key:"default",fn:function(a){return[n("bk-select",{attrs:{value:a.row["approval_turn"]||1,clearable:false}},t._l(a.row["award_reviewers_for_display"],function(t,a){return n("bk-option",{key:t["uuid"],attrs:{name:t["description"],id:a+1,title:t["description"]}})}),1)]}}])}),t._v(" "),n("bk-table-column",{attrs:{label:"评审结果",width:90},scopedSlots:t._u([{key:"default",fn:function(t){return[n("approval-state-tag",{attrs:{"approval-state-cn":t.row["approval_state_cn"],"approval-state-en":t.row["approval_state_en"]}})]}}])})],1)],1),t._v(" "),n("div",{attrs:{slot:"footer"},slot:"footer"},[n("bk-button",{staticClass:"ml20 mr20",attrs:{theme:"danger"},on:{click:function(a){t.$refs["application-detail"].hidden()}}},[t._v("取消\n            ")]),t._v(" "),n("bk-popconfirm",{attrs:{trigger:"click",width:280},on:{confirm:function(a){t.handleToOverAward(t.curAwardInfo)}}},[n("div",{attrs:{slot:"content"},slot:"content"},[n("div",[n("i",{staticClass:"bk-text-danger bk-icon icon-info-circle-shape content-icon"}),t._v(" "),n("span",{staticClass:"content-text pb10 mb20"},[t._v("结束后，所有评审中的申请将设置为\n                            "),n("em",{staticClass:"bk-text-danger"},[t._v(" 未通过")])])])]),t._v(" "),n("bk-button",{directives:[{name:"show",rawName:"v-show",value:!t.isOnlyDetail,expression:"!isOnlyDetail"}],staticClass:"ml20 mr20",attrs:{theme:"success"}},[t._v("确认结束奖项\n                ")])],1)],1)])],1)};var i=[];n.d(a,"a",function(){return e});n.d(a,"b",function(){return i})}}]);