(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[21],{308:function(t,e,a){"use strict";a.r(e);var r=a(309);var n=a.n(r);for(var i in r)if(i!=="default")(function(t){a.d(e,t,function(){return r[t]})})(i);e["default"]=n.a},309:function(t,e,a){"use strict";var r=a(1);Object.defineProperty(e,"__esModule",{value:true});e.default=void 0;var n=r(a(11));var i=r(a(12));var o=r(a(3));var l=a(7);var c=a(208);var s=a(209);var u=a(151);function p(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),a.push.apply(a,r)}return a}function d(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?p(Object(a),!0).forEach(function(e){(0,o.default)(t,e,a[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):p(Object(a)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))})}return t}var f={name:"apply-form",components:{Uploader:function t(){return a.e(16).then(a.bind(null,374))}},inject:["awardDetail"],data:function t(e){var a,r;return{config:(a={},(0,o.default)(a,l.DETAIL_APPLY,{hidden_button:false,is_editor:true,init:function t(){}}),(0,o.default)(a,l.DETAIL_EDIT,{hidden_button:false,is_editor:true,init:function t(){e.handleGetRecord()}}),(0,o.default)(a,l.DETAIL_APPLY_DETAIL,{hidden_button:true,is_editor:false,init:function t(){e.handleGetRecord()}}),(0,o.default)(a,l.DETAIL_DRAFT_DETAIL,{hidden_button:false,is_editor:true,init:function t(){}}),(0,o.default)(a,l.DETAIL_APPROVAL,{hidden_button:true,is_editor:false,init:function t(){e.handleGetRecord()}}),(0,o.default)(a,l.DETAIL_APPROVAL_RESULT_DETAIL,{hidden_button:true,is_editor:false,init:function t(){e.handleGetRecord()}}),a),configType:(r={typeTable:{DETAIL_APPLY:l.DETAIL_APPLY,DETAIL_EDIT:l.DETAIL_EDIT,DETAIL_APPLY_DETAIL:l.DETAIL_APPLY_DETAIL,DETAIL_DRAFT_DETAIL:l.DETAIL_DRAFT_DETAIL,DETAIL_APPROVAL_DETAIL:l.DETAIL_APPROVAL}},(0,o.default)(r,l.DETAIL_APPLY,l.DETAIL_APPLY),(0,o.default)(r,l.DETAIL_EDIT,l.DETAIL_EDIT),(0,o.default)(r,l.DETAIL_APPLY_DETAIL,l.DETAIL_APPLY_DETAIL),(0,o.default)(r,l.DETAIL_DRAFT_DETAIL,l.DETAIL_DRAFT_DETAIL),(0,o.default)(r,l.DETAIL_APPROVAL,l.DETAIL_APPROVAL),r),applyForm:{application_users:"",application_reason:"",application_attachments:[]},applyFormRules:Object.freeze({application_reason:[{required:true,message:"请填写申请理由",trigger:"blur"}]})}},computed:{groupUsers:function t(e){var a;return(a=e.$http.cache.get(l.GROUP_USERS_KEYNAME))!==null&&a!==void 0?a:[]},award:function t(e){return e.awardDetail()},formType:function t(e){return e.$route.query[l.DETAIL_TYPE_KEYNAME]||l.DETAIL_APPLY}},created:function t(){this.handleInit()},methods:{handleInit:function t(){var e,a;(e=this.config[this.$route.query[l.DETAIL_TYPE_KEYNAME]])===null||e===void 0?void 0:(a=e.init)===null||a===void 0?void 0:a.call(e)},handleSetDefaultInfo:function t(){},validator:function t(){return this.$refs["apply-form"].validate()},handleToSaveApplyForm:function t(e){var a=this;return(0,i.default)(n.default.mark(function t(){return n.default.wrap(function t(r){while(1){switch(r.prev=r.next){case 0:r.next=2;return a.validator();case 2:a.handleToDealWidthApply(true,e).then(function(t){a.messageSuccess("保存草稿成功");return a.$router.replace({name:l.MYAPPLY_ROUTE_PATH,query:(0,o.default)({},l.MYAPPLY_ROUTER_KEYNAME,l.MYAPPLY_DRAFT_TAB_KEYNAME)})});case 3:case"end":return r.stop()}}},t)}))()},handleToSendApplyForm:function t(e){var a=this;return(0,i.default)(n.default.mark(function t(){return n.default.wrap(function t(r){while(1){switch(r.prev=r.next){case 0:r.next=2;return a.validator();case 2:a.handleToDealWidthApply(false,e).then(function(t){a.messageSuccess("申请成功");return a.$router.replace({name:l.MYAPPLY_ROUTE_PATH,query:(0,o.default)({},l.MYAPPLY_ROUTER_KEYNAME,l.MYAPPLY_ING_APPLY_TAB_KEYNAME)})});case 3:case"end":return r.stop()}}},t)}))()},handleToDealWidthApply:function t(e,a){return(0,c.postRecord)(e,d({award_department_id:this.award["award_department_id"],award_id:this.award["id"]},a))},handleOnlyGroup:function t(e){var a=e["departments"].map(function(t){return t["full_name"]});var r=this.$route.params["award_department_fullname"];return a.includes(r)},handleGetRecord:function t(){var e=this;return(0,s.getApplicationById)(this.$route.query["record_id"]).then(function(t){var a=t.data;e.applyForm.application_users=(0,u.formatUsernameAndDisplayName)(a.application_users[0]["username"],a.application_users[0]["display_name"]);e.applyForm.application_reason=a.application_reason;e.applyForm.application_attachments=a.application_attachments})}}};e.default=f},310:function(t,e,a){},370:function(t,e,a){"use strict";a.r(e);var r=a(413);var n=a(308);for(var i in n)if(i!=="default")(function(t){a.d(e,t,function(){return n[t]})})(i);var o=a(371);var l=a(18);var c=Object(l["a"])(n["default"],r["a"],r["b"],false,null,"71f653ac",null);e["default"]=c.exports},371:function(t,e,a){"use strict";var r=a(310);var n=a.n(r);var i=n.a},413:function(t,e,a){"use strict";var r=function(){var t=this;var e=t.$createElement;var a=t._self._c||e;return a("div",{staticClass:"apply-form-container"},[a("bk-form",{ref:"apply-form",staticClass:"form",staticStyle:{height:"400px"},attrs:{"label-width":90,rules:t.applyFormRules,model:t.applyForm}},[a("bk-form-item",{directives:[{name:"show",rawName:"v-show",value:!t.config[t.formType]["is_editor"],expression:"!config[formType]['is_editor']"}],attrs:{label:"申请人"}},[a("bk-input",{attrs:{disabled:!t.config[t.formType]["is_editor"]},model:{value:t.applyForm.application_users,callback:function(e){t.$set(t.applyForm,"application_users",e)},expression:"applyForm.application_users"}})],1),t._v(" "),a("bk-form-item",{attrs:{label:"申请理由",required:true,property:"application_reason"}},[a("bk-input",{attrs:{placeholder:"请输入255字以内的申请理由",type:"textarea",rows:3,maxlength:255,disabled:!t.config[t.formType]["is_editor"]},model:{value:t.applyForm["application_reason"],callback:function(e){t.$set(t.applyForm,"application_reason",e)},expression:"applyForm['application_reason']"}})],1),t._v(" "),a("bk-form-item",{attrs:{label:"申请材料"}},[a("Uploader",{staticClass:"mb20",staticStyle:{"max-height":"300px","overflow-y":"scroll"},attrs:{limit:2,readonly:!t.config[t.formType]["is_editor"]},model:{value:t.applyForm["application_attachments"],callback:function(e){t.$set(t.applyForm,"application_attachments",e)},expression:"applyForm['application_attachments']"}})],1)],1),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:!t.config[t.formType]["hidden_button"],expression:"!config[formType]['hidden_button']"}],staticClass:"button-item"},[a("bk-button",{staticClass:"mr10",attrs:{theme:"danger","ext-cls":"button-item"},on:{click:function(e){t.$router.back()}}},[a("bk-icon",{attrs:{type:"minus-circle"}}),t._v(" "),a("span",[t._v("取消")])],1),t._v(" "),a("bk-button",{staticClass:"mr10",attrs:{theme:"primary","ext-cls":"button-item"},on:{click:function(e){t.handleToSaveApplyForm(t.applyForm)}}},[a("bk-icon",{attrs:{type:"save"}}),t._v(" "),a("span",[t._v("保存草稿")])],1),t._v(" "),[t.configType.typeTable["DETAIL_APPLY"]].includes(t.formType)?a("bk-button",{staticClass:"mr10",attrs:{theme:"success","ext-cls":"button-item"},on:{click:function(e){t.handleToSendApplyForm(t.applyForm)}}},[a("bk-icon",{attrs:{type:"check-circle"}}),t._v(" "),a("span",[t._v("发起申请")])],1):[t.configType.typeTable["DETAIL_DRAFT_DETAIL"],t.configType.typeTable["DETAIL_EDIT"]].includes(t.formType)?a("bk-button",{staticClass:"mr10",attrs:{theme:"warning","ext-cls":"button-item"},on:{click:function(e){t.handleToSendApplyForm(t.applyForm)}}},[a("bk-icon",{attrs:{type:"check-circle"}}),t._v(" "),a("span",[t._v("发起申请")])],1):t._e()],1)],1)};var n=[];a.d(e,"a",function(){return r});a.d(e,"b",function(){return n})}}]);