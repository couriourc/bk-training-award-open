(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[4],{201:function(e,t,r){"use strict";r.r(t);var a=r(327);var n=r(227);for(var i in n)if(i!=="default")(function(e){r.d(t,e,function(){return n[e]})})(i);var o=r(293);var s=r(3);var u=Object(s["a"])(n["default"],a["a"],a["b"],false,null,"1a35d288",null);t["default"]=u.exports},208:function(e,t,r){"use strict";var a=r(1);Object.defineProperty(t,"__esModule",{value:true});t.deleteAward=w;t.deleteRecord=m;t.getAppliedAwards=c;t.getAvailableAwards=l;t.getAwards=d;t.postAwards=u;t.postRecord=f;t.putAward=p;var n=a(r(5));var i=a(r(6));function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,a)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach(function(t){(0,n.default)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function u(e){return i.default.post("awards/",e)}function d(e,t){return i.default.get("awards/",{params:{page:e,size:t}})}function l(e,t){return i.default.get("get_available_awards/",{params:{page:e,size:t}})}function c(e,t){return i.default.get("get_applyed_awards/",{params:{page:e,size:t}})}function f(e,t){return i.default.post("record/",s({is_draft:e},t))}function m(e){console.log(e);return i.default.put("record/",{id:e})}function w(e){var t=e.awardId;return i.default.delete("awards/",{data:{award_id:t}})}function p(e,t){var r=t.award_name,a=t.award_level,n=t.award_description,o=t.award_consultant,s=t.award_image,u=t.award_department_fullname,d=t.award_reviewers,l=t.start_time,c=t.end_time;return i.default.put("awards/",{award_id:e,award_name:r,award_level:a,award_description:n,award_consultant:o,award_image:s,award_department_fullname:u,award_reviewers:d,start_time:l,end_time:c})}},227:function(e,t,r){"use strict";r.r(t);var a=r(228);var n=r.n(a);for(var i in a)if(i!=="default")(function(e){r.d(t,e,function(){return a[e]})})(i);t["default"]=n.a},228:function(e,t,r){"use strict";var a=r(1);Object.defineProperty(t,"__esModule",{value:true});t.default=void 0;var n=a(r(5));var i=a(r(23));var o=a(r(24));var s=r(159);var u=r(16);var d=r(208);var l=r(17);function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,a)}return r}function f(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach(function(t){(0,n.default)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var m=0;var w={name:"new-award-form",components:{SelectSearch:function e(){return r.e(0).then(r.bind(null,214))},Uploader:function e(){return r.e(2).then(r.bind(null,283))}},data:function e(){var t=this;var r=function e(t){return{required:true,message:t,trigger:"blur"}};return{awardForm:{award_name:"",award_consultant:"",start_time:new Date,end_time:new Date,award_description:"",award_level:"",award_department_fullname:"",award_department_id:"",award_attach_image:[],award_image:"",reviewers:[{uuid:m++,value:[]}]},rules:Object.freeze({award_name:[r("请输入奖项名称")],award_consultant:[r("请选择接口人")],start_time:[r("请输入开始时间")],end_time:[r("请输入截止时间")],award_description:[r("请输入奖项描述信息")],award_level:[r("请选择奖项等级信息")],award_image:[r("请传入图片")]}),awardLevels:u.AWARD_LEVEL_MAP,submitLoading:false,config:{edit:{title:"编辑奖项","title-clz":"edit","button-title":"提交修改","button-theme":"warning","confirm-func":this.handleConfirmModifyAward,"cancel-func":function e(){t.$router.replace({name:"award-manager"})}},detail:{title:"奖项详情","title-clz":"detail","button-title":"前往修改","button-theme":"primary","confirm-func":this.toModify,disabled:true,"cancel-func":function e(){t.$router.back()}},new:{title:"新增奖项","title-clz":"new","button-title":"确认新增","button-theme":"success","confirm-func":this.handleConfirmAddNewAward,"cancel-func":function e(){t.$router.back()}}}}},computed:{formType:function e(t){return t.$route.query.type},groupInfo:{get:function e(t){return t.awardForm.award_department_fullname},set:function e(t){var r=this.awardForm;r.award_department_fullname=t}}},created:function e(){m=0;this.$once("hook:beforeDestroy",function(){m=null});this.handleInit()},methods:{handleInit:function e(){this.handleSetDefaultInfo()},handleSetDefaultInfo:function e(){var t=this.$route.params;if(t.hasOwnProperty("id")){t["award_attach_image"]=[{name:t["award_name"],url:t["award_image"]}];t["reviewers"]=t["award_reviewers"]&&t["award_reviewers"].map(function(e){return{uuid:m++,value:e}});this.awardForm=t}},validator:function e(){var t=this;return new Promise(function(e){var r=t.awardForm;var a=true;t.$refs["Form"].validate().then(function(n){var i,o,s;var u=r["start_time"].getTime();var d=r["end_time"].getTime();if(u>=d){t.messageWarn("开始时间应该早于截止时间");a=false}if(!(r["reviewers"]&&r["reviewers"][0].value.length)){t.messageWarn("至少有一级评审人");a=false}if(!(r!==null&&r!==void 0&&(i=r.award_attach_image)!==null&&i!==void 0&&(o=i.slice)!==null&&o!==void 0&&(s=o.call(i,-1)[0])!==null&&s!==void 0&&s["path"])){t.messageWarn("请上传图片");a=false}return e(a)}).catch(function(t){a=false;return e(a)})})},getFields:function e(){var t=this;return(0,o.default)(i.default.mark(function e(){var r,a;return i.default.wrap(function e(n){while(1){switch(n.prev=n.next){case 0:n.next=2;return t.validator();case 2:r=n.sent;if(!r){n.next=10;break}a=t.awardForm;a.award_reviewers=a.reviewers.map(function(e){return e["value"]}).filter(function(e){return e.length});a.start_time=(0,s.formatDate)(a.start_time).format("YYYY-MM-DD hh:mm:ss");a.end_time=(0,s.formatDate)(a.end_time).format("YYYY-MM-DD hh:mm:ss");a.award_image=a.award_attach_image&&a.award_attach_image.slice(-1)[0]["path"];return n.abrupt("return",a);case 10:return n.abrupt("return",null);case 11:case"end":return n.stop()}}},e)}))()},addReviewer:function e(t){t.push({uuid:m++,value:[]})},removeReviewer:function e(t,r){var a=t.findIndex(function(e){return e.uuid===r});t.splice(a,1)},handleConfirmAddNewAward:function e(){var t=this;return(0,o.default)(i.default.mark(function e(){var r;return i.default.wrap(function e(a){while(1){switch(a.prev=a.next){case 0:a.next=2;return t.getFields();case 2:r=a.sent;if(r){a.next=5;break}return a.abrupt("return",null);case 5:if(!t.submitLoading){a.next=7;break}return a.abrupt("return",null);case 7:t.submitLoading=true;return a.abrupt("return",(0,d.postAwards)(r).then(function(e){l.bus.$emit("set-award-manager-init");t.messageSuccess("创建成功");t.$router.replace({name:"award-manager"})}).catch(function(e){t.messageWarn("创建失败")}).finally(function(e){t.submitLoading=false}));case 9:case"end":return a.stop()}}},e)}))()},handleConfirmModifyAward:function e(){var t=this;return(0,o.default)(i.default.mark(function e(){var r;return i.default.wrap(function e(a){while(1){switch(a.prev=a.next){case 0:a.next=2;return t.getFields();case 2:r=a.sent;if(r){a.next=5;break}return a.abrupt("return",null);case 5:if(!t.submitLoading){a.next=7;break}return a.abrupt("return",null);case 7:t.submitLoading=true;return a.abrupt("return",(0,d.putAward)(t.$route.params["id"],r).then(function(e){l.bus.$emit("set-award-manager-init");t.messageSuccess("修改成功")}).catch(function(e){t.messageWarn("修改失败")}).finally(function(e){t.submitLoading=false}));case 9:case"end":return a.stop()}}},e)}))()},toModify:function e(){return this.$router.push({name:"award-form",query:{type:"edit"},params:f({},this.$route.params)})}}};t.default=w},229:function(e,t,r){},293:function(e,t,r){"use strict";var a=r(229);var n=r.n(a);var i=n.a},327:function(e,t,r){"use strict";var a=function(){var e=this;var t=e.$createElement;var r=e._self._c||t;return r("div",{staticClass:"new-award-form-container"},[r("div",{class:["title",e.config[e.formType]["title-clz"]]},[e._v("\n        "+e._s(e.config[e.formType]["title"])+"\n    ")]),e._v(" "),r("bk-form",{ref:"Form",attrs:{"label-width":110,"form-type":"vertical",rules:e.rules,model:e.awardForm}},[r("bk-container",{attrs:{col:12,"ext-cls":"award-form-container",gutter:60,flex:true}},[r("bk-row",[r("bk-col",{attrs:{span:6}},[r("bk-form-item",{attrs:{label:"奖项名称",required:true,property:"award_name"}},[r("bk-input",{attrs:{placeholder:"请输入奖项名称",disabled:e.config[e.formType]["disabled"]},model:{value:e.awardForm["award_name"],callback:function(t){e.$set(e.awardForm,"award_name",t)},expression:"awardForm['award_name']"}})],1)],1),e._v(" "),r("bk-col",{attrs:{span:6}},[r("bk-form-item",{attrs:{label:"接口人",property:"award_consultant"}},[r("select-search",{staticStyle:{width:"100%"},attrs:{value:e.awardForm["award_consultant"],"ext-cls":"select-custom",placeholder:"请选择接口人",disabled:e.config[e.formType]["disabled"],multiple:false,"id-key":"username"},on:{"update:value":function(t){e.$set(e.awardForm,"award_consultant",t)}}})],1)],1)],1),e._v(" "),r("bk-row",[r("bk-col",{attrs:{span:6}},[r("bk-form-item",{attrs:{"label-width":120,label:"开始申请时间",required:true,property:"start_time"}},[r("bk-date-picker",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择开始申请时间",disabled:e.config[e.formType]["disabled"],"ext-popover-cls":"custom-popover-cls",type:"datetime"},model:{value:e.awardForm["start_time"],callback:function(t){e.$set(e.awardForm,"start_time",t)},expression:"awardForm['start_time']"}})],1)],1),e._v(" "),r("bk-col",{attrs:{span:6}},[r("bk-form-item",{attrs:{label:"截止申请时间",required:true,property:"end_time"}},[r("bk-date-picker",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择截止申请时间","ext-popover-cls":"custom-popover-cls",type:"datetime",disabled:e.config[e.formType]["disabled"]},model:{value:e.awardForm["end_time"],callback:function(t){e.$set(e.awardForm,"end_time",t)},expression:"awardForm['end_time']"}})],1)],1)],1),e._v(" "),r("bk-row",[r("bk-col",{attrs:{span:6}},[r("bk-form-item",{attrs:{label:"描述信息",required:true,property:"award_description"}},[r("bk-input",{attrs:{type:"textarea",rows:3,maxlength:255,placeholder:"请输入描述信息",disabled:e.config[e.formType]["disabled"]},model:{value:e.awardForm["award_description"],callback:function(t){e.$set(e.awardForm,"award_description",t)},expression:"awardForm['award_description']"}})],1)],1),e._v(" "),r("bk-col",{attrs:{span:6}},[r("bk-form-item",{attrs:{label:"图片",property:"award_a"}},[r("Uploader",{attrs:{limit:1,theme:"picture",multiple:false},model:{value:e.awardForm["award_attach_image"],callback:function(t){e.$set(e.awardForm,"award_attach_image",t)},expression:"awardForm['award_attach_image']"}})],1)],1)],1),e._v(" "),r("bk-row",[r("bk-col",{attrs:{span:6}},[r("bk-form-item",{attrs:{label:"奖项级别",required:true,property:"award_level"}},[r("bk-select",{attrs:{placeholder:"请选择奖项级别",disabled:e.config[e.formType]["disabled"]},model:{value:e.awardForm["award_level"],callback:function(t){e.$set(e.awardForm,"award_level",t)},expression:"awardForm['award_level']"}},e._l(e.awardLevels,function(e){return r("bk-option",{key:e,attrs:{id:e,name:e}})}),1)],1)],1),e._v(" "),r("bk-col",{attrs:{span:6}},[r("bk-form-item",{attrs:{label:"所属组织",required:true,property:"award_level"}},[r("select-search",{attrs:{value:e.groupInfo,placeholder:"请选择奖项所属组织",multiple:false,disabled:e.config[e.formType]["disabled"],type:"secretary","id-key":"full_name"},on:{"update:value":function(t){e.groupInfo=t}}})],1)],1)],1),e._v(" "),r("bk-divider"),e._v(" "),r("bk-row",[r("bk-col",{attrs:{span:12}},[r("bk-form-item",{attrs:{"label-width":"auto",label:"审批步骤: 1.xxx 2.xxx",required:true}},e._l(e.awardForm["reviewers"],function(t,a){return r("div",{key:t.uuid,staticClass:"form-group mt10"},[r("span",{staticClass:"mr10"},[e._v("第 "+e._s(a+1)+" 批：")]),e._v(" "),r("select-search",{staticStyle:{width:"80%"},attrs:{value:t.value,placeholder:"请选择评审人",disabled:e.config[e.formType]["disabled"],"id-key":"username"},on:{"update:value":function(r){e.$set(t,"value",r)}}}),e._v(" "),r("div",{staticClass:"ml15"},[r("bk-button",{directives:[{name:"show",rawName:"v-show",value:e.awardForm["reviewers"].length>1,expression:"awardForm['reviewers'].length > 1"}],attrs:{theme:"danger",title:"移除同级评审人",icon:"minus-circle-shape"},on:{click:function(r){e.removeReviewer(e.awardForm["reviewers"],t.uuid)}}}),e._v(" "),r("bk-button",{directives:[{name:"show",rawName:"v-show",value:a===e.awardForm["reviewers"].length-1,expression:"index === awardForm['reviewers'].length - 1"}],attrs:{theme:"primary",title:"添加同级评审人",icon:"plus-circle-shape"},on:{click:function(t){e.addReviewer(e.awardForm["reviewers"])}}})],1)],1)}),0)],1)],1)],1)],1),e._v(" "),r("div",{staticClass:"center-content"},[r("bk-button",{staticClass:"mr10",attrs:{theme:"danger"},on:{click:e.config[e.formType]["cancel-func"]}},[e._v("\n            取消\n        ")]),e._v(" "),r("bk-button",{staticClass:"ml10",attrs:{theme:e.config[e.formType]["button-theme"],loading:e.submitLoading},on:{click:function(t){e.config[e.formType]["confirm-func"](t)}}},[e._v("\n            "+e._s(e.config[e.formType]["button-title"])+"\n        ")])],1)],1)};var n=[];r.d(t,"a",function(){return a});r.d(t,"b",function(){return n})}}]);