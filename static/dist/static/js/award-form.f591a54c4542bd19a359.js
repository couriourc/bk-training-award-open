(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[4],{199:function(e,t,r){"use strict";r.r(t);var a=r(324);var n=r(223);for(var i in n)if(i!=="default")(function(e){r.d(t,e,function(){return n[e]})})(i);var o=r(292);var d=r(3);var u=Object(d["a"])(n["default"],a["a"],a["b"],false,null,null,null);t["default"]=u.exports},206:function(e,t,r){"use strict";var a=r(1);Object.defineProperty(t,"__esModule",{value:true});t.REVIEW_PENDING=t.REVIEW_PASSED=t.REVIEW_NOT_PASSED=t.NOT_APPLY=t.GROUP_USERS_KEYNAME=t.GROUP_KEYNAME=t.ENDED=t.DRAFT=t.AWARD_LEVEL_MAP=t.AWARD_LEVEL_EN_MAP=t.AWARD_APPROVAL_STATE_MAP=t.AWARD_APPROVAL_STATE_EN_MAP=t.APPROVAL_STATE=t.APPLY_APPROVAL_STATE_MAP=t.APPLY_APPROVAL_STATE_EN_MAP=t.APPLYED=void 0;var n=a(r(5));var i,o,d,u,l,s,c;var f=0;t.NOT_APPLY=f;var m=1;t.APPLYED=m;var p=2;t.ENDED=p;var w=(i={},(0,n.default)(i,f,f),(0,n.default)(i,m,m),i);t.APPROVAL_STATE=w;var _=(o={},(0,n.default)(o,f,"未开始"),(0,n.default)(o,m,"申请中"),(0,n.default)(o,p,"已结束"),o);t.AWARD_APPROVAL_STATE_MAP=_;var v=(d={},(0,n.default)(d,f,"not_apply"),(0,n.default)(d,m,"applyied"),(0,n.default)(d,p,"ended"),d);t.AWARD_APPROVAL_STATE_EN_MAP=v;var b=0;t.REVIEW_PENDING=b;var h=1;t.REVIEW_PASSED=h;var g=2;t.REVIEW_NOT_PASSED=g;var A=3;t.DRAFT=A;var P=(u={},(0,n.default)(u,b,"待评审"),(0,n.default)(u,h,"评审通过"),(0,n.default)(u,g,"评审不通过"),(0,n.default)(u,A,"草稿"),u);t.APPLY_APPROVAL_STATE_MAP=P;var y=(l={},(0,n.default)(l,b,"review_pending"),(0,n.default)(l,h,"review_passed"),(0,n.default)(l,g,"review_not_passed"),(0,n.default)(l,A,"draft"),l);t.APPLY_APPROVAL_STATE_EN_MAP=y;var E=0;var k=1;var O=(s={},(0,n.default)(s,E,"公司"),(0,n.default)(s,k,"小组"),s);t.AWARD_LEVEL_MAP=O;var T=(c={},(0,n.default)(c,E,"company"),(0,n.default)(c,k,"group"),c);t.AWARD_LEVEL_EN_MAP=T;var D="groupUser";t.GROUP_USERS_KEYNAME=D;var F="group";t.GROUP_KEYNAME=F},207:function(e,t,r){"use strict";var a=r(1);Object.defineProperty(t,"__esModule",{value:true});t.deleteAward=p;t.deleteRecord=m;t.getAppliedAwards=c;t.getAvailableAwards=s;t.getAwards=l;t.postAwards=u;t.postRecord=f;t.putAward=w;var n=a(r(5));var i=a(r(15));function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,a)}return r}function d(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach(function(t){(0,n.default)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function u(e){return i.default.post("awards/",e)}function l(e,t){return i.default.get("awards/",{params:{page:e,size:t}})}function s(e,t){return i.default.get("get_available_awards/",{params:{page:e,size:t}})}function c(e,t){return i.default.get("get_applyed_awards/",{params:{page:e,size:t}})}function f(e,t){return i.default.post("record/",d({is_draft:e},t))}function m(e){return i.default.post("record/",{id:e})}function p(e){var t=e.awardId;return i.default.delete("awards/",{params:{award_id:t}})}function w(e,t){var r=t.award_name,a=t.award_level,n=t.award_description,o=t.award_consultant,d=t.award_image,u=t.award_department_fullname,l=t.award_reviewers,s=t.start_time,c=t.end_time;return i.default.put("awards/",{award_id:e,award_name:r,award_level:a,award_description:n,award_consultant:o,award_image:d,award_department_fullname:u,award_reviewers:l,start_time:s,end_time:c})}},223:function(e,t,r){"use strict";r.r(t);var a=r(224);var n=r.n(a);for(var i in a)if(i!=="default")(function(e){r.d(t,e,function(){return a[e]})})(i);t["default"]=n.a},224:function(e,t,r){"use strict";var a=r(1);Object.defineProperty(t,"__esModule",{value:true});t.default=void 0;var n=a(r(5));var i=a(r(21));var o=a(r(22));var d=r(157);var u=r(206);var l=r(207);function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,a)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach(function(t){(0,n.default)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var f=0;var m={name:"new-award-form",components:{SelectSearch:function e(){return r.e(0).then(r.bind(null,265))},Uploader:function e(){return r.e(2).then(r.bind(null,281))}},data:function e(){var t=this;var r=function e(t){return{required:true,message:t,trigger:"blur"}};return{awardForm:{award_name:"",award_consultant:"",start_time:new Date,end_time:new Date,award_description:"",award_level:"",award_department_fullname:"",award_department_id:"",award_attach_image:[],award_image:"",reviewers:[{uuid:f++,value:[]}]},rules:Object.freeze({award_name:[r("请输入奖项名称")],award_consultant:[r("请选择接口人")],start_time:[r("请输入开始时间")],end_time:[r("请输入截止时间")],award_description:[r("请输入奖项描述信息")],award_level:[r("请选择奖项等级信息")],award_image:[r("请传入图片")]}),awardLevels:u.AWARD_LEVEL_MAP,submitLoading:false,config:{edit:{title:"编辑奖项","title-clz":"edit","button-title":"提交修改","button-theme":"warning","confirm-func":this.handleConfirmModifyAward,"cancel-func":function e(){t.$router.replace({name:"award-manager"})}},detail:{title:"奖项详情","title-clz":"detail","button-title":"前往修改","button-theme":"primary","confirm-func":this.toModify,disabled:true,"cancel-func":function e(){t.$router.back()}},new:{title:"新增奖项","title-clz":"new","button-title":"确认新增","button-theme":"success","confirm-func":this.handleConfirmAddNewAward,"cancel-func":function e(){t.$router.back()}}}}},computed:{formType:function e(t){console.log(t.$route.type);return t.$route.params.type},groupInfo:{get:function e(t){return t.awardForm.award_department_id},set:function e(t){var r=this.awardForm;var a=this.$http.cache.get(u.GROUP_KEYNAME);r.award_department_id=t;r.award_department_fullname=a.find(function(e){return e.id===t})["full_name"]}}},created:function e(){this.handleInit()},methods:{handleInit:function e(){this.handleSetDefaultInfo()},handleSetDefaultInfo:function e(){var t=this.$route.params;if(t.hasOwnProperty("id")){t["award_attach_image"]=[{name:t["award_name"],url:t["award_image"]}];t["reviewers"]=t["award_reviewers"]&&t["award_reviewers"].map(function(e){return{uuid:f++,value:e}});this.awardForm=t}},validator:function e(){var t=this;return new Promise(function(e,r){var a=t.awardForm;var n=true;t.$refs["Form"].validate().then(function(r){var i,o,d;var u=a["start_time"].getTime();var l=a["end_time"].getTime();if(u>=l){t.messageWarn("开始时间应该早于截止时间");n=false}if(!(a["reviewers"]&&a["reviewers"][0].value.length)){t.messageWarn("至少有一级评审人");n=false}if(!(a!==null&&a!==void 0&&(i=a.award_attach_image)!==null&&i!==void 0&&(o=i.slice)!==null&&o!==void 0&&(d=o.call(i,-1)[0])!==null&&d!==void 0&&d["path"])){t.messageWarn("请上传图片");n=false}return e(n)}).catch(function(t){n=false;return e(n)})})},getFields:function e(){var t=this;return(0,o.default)(i.default.mark(function e(){var r,a;return i.default.wrap(function e(n){while(1){switch(n.prev=n.next){case 0:n.next=2;return t.validator();case 2:r=n.sent;if(!r){n.next=11;break}a=t.awardForm;a.award_reviewers=a.reviewers.map(function(e){return e["value"]}).filter(function(e){return e.length});a.start_time=(0,d.formatDate)(a.start_time).format("YYYY-MM-DD hh:mm:ss");a.end_time=(0,d.formatDate)(a.end_time).format("YYYY-MM-DD hh:mm:ss");console.log(a.award_attach_image);a.award_image=a.award_attach_image&&a.award_attach_image.slice(-1)[0]["path"];return n.abrupt("return",a);case 11:return n.abrupt("return",null);case 12:case"end":return n.stop()}}},e)}))()},addReviewer:function e(t){t.push({uuid:f++,value:[]})},removeReviewer:function e(t,r){var a=t.findIndex(function(e){return e.uuid===r});t.splice(a,1)},handleConfirmAddNewAward:function e(){var t=this;return(0,o.default)(i.default.mark(function e(){var r;return i.default.wrap(function e(a){while(1){switch(a.prev=a.next){case 0:a.next=2;return t.getFields();case 2:r=a.sent;if(r){a.next=5;break}return a.abrupt("return",null);case 5:if(!t.submitLoading){a.next=7;break}return a.abrupt("return",null);case 7:t.submitLoading=true;return a.abrupt("return",(0,l.postAwards)(r).then(function(e){t.messageSuccess("创建成功")}).catch(function(e){t.messageWarn("创建失败")}).finally(function(e){t.submitLoading=false}));case 9:case"end":return a.stop()}}},e)}))()},handleConfirmModifyAward:function e(){var t=this;return(0,o.default)(i.default.mark(function e(){var r;return i.default.wrap(function e(a){while(1){switch(a.prev=a.next){case 0:a.next=2;return t.getFields();case 2:r=a.sent;if(r){a.next=5;break}return a.abrupt("return",null);case 5:if(!t.submitLoading){a.next=7;break}return a.abrupt("return",null);case 7:t.submitLoading=true;return a.abrupt("return",(0,l.putAward)(t.$route.params["id"],r).then(function(e){t.messageSuccess("修改成功")}).catch(function(e){t.messageWarn("修改失败")}).finally(function(e){t.submitLoading=false}));case 9:case"end":return a.stop()}}},e)}))()},toModify:function e(){return this.$router.push({name:"award-form",path:"award-manager/award-form/edit",params:c(c({},this.$route.params),{},{type:"edit"})})}}};t.default=m},225:function(e,t,r){},292:function(e,t,r){"use strict";var a=r(225);var n=r.n(a);var i=n.a},324:function(e,t,r){"use strict";var a=function(){var e=this;var t=e.$createElement;var r=e._self._c||t;return r("div",{staticClass:"new-award-form-container"},[r("div",{class:["title",e.config[e.formType]["title-clz"]]},[e._v("\n        "+e._s(e.config[e.formType]["title"])+"\n    ")]),e._v(" "),r("bk-form",{ref:"Form",attrs:{"label-width":110,"form-type":"vertical",rules:e.rules,model:e.awardForm}},[r("bk-container",{attrs:{col:12,"ext-cls":"award-form-container",gutter:60,flex:true}},[r("bk-row",[r("bk-col",{attrs:{span:6}},[r("bk-form-item",{attrs:{label:"奖项名称",required:true,property:"award_name"}},[r("bk-input",{attrs:{placeholder:"请输入奖项名称",disabled:e.config[e.formType]["disabled"]},model:{value:e.awardForm["award_name"],callback:function(t){e.$set(e.awardForm,"award_name",t)},expression:"awardForm['award_name']"}})],1)],1),e._v(" "),r("bk-col",{attrs:{span:6}},[r("bk-form-item",{attrs:{label:"接口人",property:"award_consultant"}},[r("select-search",{staticStyle:{width:"100%"},attrs:{value:e.awardForm["award_consultant"],"ext-cls":"select-custom",placeholder:"请选择接口人",disabled:e.config[e.formType]["disabled"],multiple:false},on:{"update:value":function(t){e.$set(e.awardForm,"award_consultant",t)}}})],1)],1)],1),e._v(" "),r("bk-row",[r("bk-col",{attrs:{span:6}},[r("bk-form-item",{attrs:{"label-width":120,label:"开始申请时间",required:true,property:"start_time"}},[r("bk-date-picker",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择开始申请时间",disabled:e.config[e.formType]["disabled"],"ext-popover-cls":"custom-popover-cls",type:"datetime"},model:{value:e.awardForm["start_time"],callback:function(t){e.$set(e.awardForm,"start_time",t)},expression:"awardForm['start_time']"}})],1)],1),e._v(" "),r("bk-col",{attrs:{span:6}},[r("bk-form-item",{attrs:{label:"截止申请时间",required:true,property:"end_time"}},[r("bk-date-picker",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择截止申请时间","ext-popover-cls":"custom-popover-cls",type:"datetime",disabled:e.config[e.formType]["disabled"]},model:{value:e.awardForm["end_time"],callback:function(t){e.$set(e.awardForm,"end_time",t)},expression:"awardForm['end_time']"}})],1)],1)],1),e._v(" "),r("bk-row",[r("bk-col",{attrs:{span:6}},[r("bk-form-item",{attrs:{label:"描述信息",required:true,property:"award_description"}},[r("bk-input",{attrs:{type:"textarea",rows:3,maxlength:255,placeholder:"请输入描述信息",disabled:e.config[e.formType]["disabled"]},model:{value:e.awardForm["award_description"],callback:function(t){e.$set(e.awardForm,"award_description",t)},expression:"awardForm['award_description']"}})],1)],1),e._v(" "),r("bk-col",{attrs:{span:6}},[r("bk-form-item",{attrs:{label:"图片",property:"award_a"}},[r("Uploader",{attrs:{limit:1,theme:"picture",multiple:false},model:{value:e.awardForm["award_attach_image"],callback:function(t){e.$set(e.awardForm,"award_attach_image",t)},expression:"awardForm['award_attach_image']"}})],1)],1)],1),e._v(" "),r("bk-row",[r("bk-col",{attrs:{span:6}},[r("bk-form-item",{attrs:{label:"奖项级别",required:true,property:"award_level"}},[r("bk-select",{attrs:{placeholder:"请选择奖项级别",disabled:e.config[e.formType]["disabled"]},model:{value:e.awardForm["award_level"],callback:function(t){e.$set(e.awardForm,"award_level",t)},expression:"awardForm['award_level']"}},e._l(e.awardLevels,function(e){return r("bk-option",{key:e,attrs:{id:e,name:e}})}),1)],1)],1),e._v(" "),r("bk-col",{attrs:{span:6}},[r("bk-form-item",{attrs:{label:"所属组织",required:true,property:"award_level"}},[r("select-search",{attrs:{value:e.groupInfo,placeholder:"请选择奖项所属组织",multiple:false,disabled:e.config[e.formType]["disabled"],type:"group"},on:{"update:value":function(t){e.groupInfo=t}}})],1)],1)],1),e._v(" "),r("bk-divider"),e._v(" "),r("bk-row",[r("bk-col",{attrs:{span:12}},[r("bk-form-item",{attrs:{"label-width":"auto",label:"评审人(*同级审批为[或审批]，异级审批为[与审批])",required:true}},e._l(e.awardForm["reviewers"],function(t,a){return r("div",{key:t.uuid,staticClass:"form-group mt10"},[r("select-search",{staticStyle:{width:"80%"},attrs:{value:t.value,placeholder:"请选择评审人",disabled:e.config[e.formType]["disabled"]},on:{"update:value":function(r){e.$set(t,"value",r)}}}),e._v(" "),r("div",{staticClass:"ml15"},[r("bk-button",{directives:[{name:"show",rawName:"v-show",value:a===e.awardForm["reviewers"].length-1,expression:"index === awardForm['reviewers'].length - 1"}],attrs:{theme:"primary",title:"添加同级评审人",icon:"plus-circle-shape"},on:{click:function(t){e.addReviewer(e.awardForm["reviewers"])}}}),e._v(" "),r("bk-button",{directives:[{name:"show",rawName:"v-show",value:a!==e.awardForm["reviewers"].length-1,expression:"index !== awardForm['reviewers'].length - 1"}],attrs:{theme:"danger",title:"移除同级评审人",icon:"minus-circle-shape"},on:{click:function(r){e.removeReviewer(e.awardForm["reviewers"],t.uuid)}}})],1)],1)}),0)],1)],1)],1)],1),e._v(" "),r("div",{staticClass:"center-content"},[r("bk-button",{staticClass:"mr10",attrs:{theme:"danger"},on:{click:e.config[e.formType]["cancel-func"]}},[e._v("\n            取消\n        ")]),e._v(" "),r("bk-button",{staticClass:"ml10",attrs:{theme:e.config[e.formType]["button-theme"],loading:e.submitLoading},on:{click:function(t){e.config[e.formType]["confirm-func"](t)}}},[e._v("\n            "+e._s(e.config[e.formType]["button-title"])+"\n        ")])],1)],1)};var n=[];r.d(t,"a",function(){return a});r.d(t,"b",function(){return n})}}]);